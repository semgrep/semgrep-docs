---
slug: notifications
append_help_link: true
title: Alerts and notifications
hide_title: true
toc_max_heading_level: 4
description: "Learn how to receive Slack or email alerts about findings and failures, how to receive merge or pull request comments in your CI/CD pipeline, or how to integrate using webhooks."
tags:
    - Semgrep Cloud Platform
    - Community Tier
    - Team & Enterprise Tier
---

import MoreHelp from "/src/components/MoreHelp"
import ProcedureIntegrateSlack from "/src/components/procedure/_integrate-slack.mdx"
import EnableAutofix from "/src/components/procedure/_enable-autofix.mdx"

<ul id="tag__badge-list">
{
Object.entries(frontMatter).filter(
    frontmatter => frontmatter[0] === 'tags')[0].pop().map(
    (value) => <li class='tag__badge-item'>{value}</li> )
}
</ul>

# Alerts and notifications

Receive notifications in various channels, such as Slack and email, through Semgrep Cloud Platform. This document guides you through setup procedures and Semgrep's deduplication behavior. This ensures that you receive high-signal notifications and alerts in your preferred channels.

Semgrep Cloud Platform provides support for the following channels:

| Tool                               | Tier availability |
| ----                               | ----------------  |
| Slack                              | Community (Free)  |
| Email                              | Community (Free)  |
| GitHub pull request (PR) comments  | Community (Free)  |
| GitLab merge request (MR) comments | Community (Free)  |
| Bitbucket PR comments              | Community (Free)  |
| Webhooks                           | Team/Enterprise   |

## Finding available alert and notification channels

To find available [integrations for Semgrep Cloud Platform](https://semgrep.dev/orgs/-/settings/integrations), follow these steps:

1. Sign in to your [Semgrep Cloud Platform account](https://semgrep.dev/).
2. Click **Settings**.
3. Click **Integrations**.
    ![Screenshot of Semgrep's "Create New Integration Channel" menu](/img/integration-firstview.png)
4. Click **Add Integration** (or **Setup First Integration** if this is your first integration).
    ![Screenshot of Integrations page while adding the first integration.](/img/integrations.png)<br />

## Managing alerts and notifications

To view, add, remove, disable, or enable your saved channels:

1. In the **Settings** > **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)** page, explore the options available for specific integration.
2. In the **[Rule board](https://semgrep.dev/orgs/-/board)**, click the <i class="fa-solid fa-gear"></i> **gear** icon to enable or disable an integration.
    ![Screenshot of Semgrep's Rule board integration modal](/img/rule-board-integrations.png)

## Setting up and customizing notification channels

### Slack

<!-- When referring to the Slack integration, let's consistently call it the "Semgrep Slack app" (app in lower case). This is consistent with the terminology used by Slack (they refer to these integrations as apps in their product pages. It also makes sure that the user knows what "app" we're referring to.

Prefer "Semgrep Slack app" over "Semgrep Slack integration" or "Slack integration" or any other variant. -->

<!-- <ProcedureIntegrateSlack /> -->

The Semgrep Slack app enables Semgrep Cloud Platform to notify you of new findings after every scan. By receiving notifications within your Slack workspace, developers and security engineers are able to see findings without leaving their current environment. This can lessen the friction between detecting a finding, triaging it, and resolving it.

You can select which channels in your Slack workspace will receive findings. You can also choose to receive findings only for certain repositories (projects) or **policies**. 

**Policies **typically correspond to the different Rule board columns. For example, you can choose to receive notifications only for findings generated by rules from the Rule Board's Blocking column.

:::info Prerequisite
You must be a Slack **Workspace Owner** to set up the Semgrep Slack app. 
:::

#### Installing Semgrep Slack App

To install the Semgrep Slack app, follow these steps:

1. In [Semgrep Cloud Platform](https://semgrep.dev/login), go to **Settings** > **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)**.
2. On the **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)** page, click **Add Integration** (or **Setup First Integration** if this is your first integration), and then select **Slack**.
3. Click **Allow**.

#### Setting up notifications for findings in Slack

To set up or subscribe to notifications for findings in your Slack workspace, perform the following steps:

1. In your Slack workspace, find or create a channel for Semgrep notifications.
2. In the selected Slack channel, enter the following slash command: `/semgrep_subscribe`.
3. Optional: Enter the name of a specific project after `/semgrep_subscribe` to receive findings for that specific project only, for example, `/semgrep_subscribe acme-corp/vulnerable-repo`. The project must be entered in the following format:
    <br />
    <code>/semgrep_subscribe <span className="placeholder">ACCOUNT_NAME/REPOSITORY_NAME</span></code>
4. Choose an organization in the list under **Select target organization**. The dialog box expands with additional options.
    ![Semgrep Slack app dialog box for subscribing to notifications](/img/semgrep-slack-subscribe.png "Semgrep Slack app dialog box for subscribing to notifications")
5. Optional: Set up additional filters.
    1. For Semgrep users that receive both Semgrep Code findings and Semgrep Supply Chain vulnerabilities, you can select **target scan types** to subscribe to either Semgrep Code, Semgrep Supply Chain, or both.
    2. Select any number of policies to receive findings for under the **Selected Policies** field. By default, you are subscribed to all policies, including the Monitor policy. This can potentially result in a noisy message.
6. Click **Subscribe**. If you did not specify a project after `/semgrep_subscribe`, the channel is subscribed to findings from all your repositories in Semgrep Cloud Platform.
7. Optional: To set up Slack notifications for additional workspaces, repeat steps 1 to 6. The Semgrep Slack integration is set up on a per-workspace basis.

You have successfully set up notifications for Semgrep findings. The Semgrep Slack app reports new findings after every scan but does not report findings that were previously discovered.

:::tip Suggested workflow
In your Slack workspace, create separate channels for either policies, repositories (projects), or types of findings depending on your business or development need. This ensures that developers receive only findings that are relevant to them. 
:::

![Message from Semgrep Slack app consolidating findings after a scan](/img/slack-findings-message.png#bordered "Message from Semgrep Slack app consolidating findings after a scan")
_Figure 1_. A sample Slack message with Semgrep findings.

#### Removing notifications for findings in Slack

:::note
This operation removes or unsubscribes a channel from notifications. To uninstall the Semgrep Slack App, refer to [Uninstalling the Semgrep Slack App from your Slack workspace
](#uninstalling-the-semgrep-slack-app-from-your-slack-workspace).
:::

To remove or unsubscribe to notifications:

1. In Slack, enter the channel that you want to unsubscribe from Semgrep findings.
2. Type `/semgrep_unsubscribe`.
3. Select the target organization to unsubscribe from.
4. Click **Unsubscribe**.

You have unsubscribed from Semgrep finding notifications for that particular channel.

#### Changing Slack notification settings

You can customize your notification settings at any time through the **Semgrep App Home** in your Slack workplace.

To view the Semgrep App Home:

1. In your Slack workspace,  click **+ Add apps**, which can be found in the sidebar under the **Apps** header.
2. Click **Semgrep**. The Semgrep app appears as a button on the sidebar.

To change the settings:

1. In your Slack workspace, click **Semgrep** under **Apps** in the Slack sidebar. This displays the **Semgrep App Home**.
2. Click the **three-dot menu** of the channel to update.
3. Click **Manage filters**.

#### Uninstalling the Semgrep Slack App from your Slack workspace

:::caution
This removes **all** Semgrep notifications in **all** channels in your Slack workspace. 
:::

To uninstall the Semgrep Slack App entirely from your Slack workspace, perform the following steps:

1. In [Semgrep Cloud Platform](https://semgrep.dev/login), go to **Settings** > **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)**.
2. On the **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)** page, find the Slack integration you want to remove.
3. Click **Remove integration** > **Remove**.

#### Troubleshooting

#### Not receiving any findings

The following list describes possible ways to troubleshoot findings not appearing in your Slack workspace:

* Check if you have successfully set up your notifications.
* Check if your most recent scan has findings to send.
* Check your filters.

##### Check notifications

To check that your notifications are set up, receive a test message from Semgrep:

1. In your Slack workspace, click **Semgrep** under **Apps** in the Slack sidebar.
2. Click the **three-dot menu** > **Send Test Notification**.

##### Check your filters

If you have set up any filter, such as filtering for a specific policy or project, all conditions of that filter must be present for the notificatin to be sent. Review your filters by following the steps in [Changing Slack notification settings](#changing-slack-notification-settings).


#### Permissions not up-to-date

You may receive a message from Semgrep Slack app stating that your token does not have up-to-date permissions. Clicking the link provided in the message to update the permissions typically resolves this issue.

However, if after updating the token, you still receive the same message, perform the following steps to revoke and refresh your access token:

1. In your Slack workspace, click **Semgrep** under **Apps** in the Slack sidebar.
2. Click Uninstall. This revokes your token.
3. Go to Semgrep Cloud Platform > Settings > Integrations.
4. Find the Slack entry for the workspace you revoked in step 2 and click **Refresh Token**.
5. Follow the steps in the authentication flow to complete the token refresh.

You have refreshed your access token and updated your permissions.

#### Fixing `dispatch_failed` error

There are many possible causes for this error. Try the following fixes:

* Re-enter your last command or operation after a few minutes.
* Uninstall, and then reinstall your Semgrep Slack integration.

#### Fixing `operation_timeout` error

This error occasionally appears due to connection or service issues. To fix this issue, retry your last command or operation after a few minutes.

#### Slack permissions 

The following table describes the purpose for each permission required to use the Semgrep Slack app. 

<table>
  <tr>
   <td><strong>Permission</strong>
   </td>
   <td><strong>Slack description</strong>
   </td>
   <td><strong>Purpose</strong>
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/app_mentions:read">app_mentions:read</a></strong>
   </td>
   <td>View messages that directly mention <code>@Semgrep</code> in conversations that the app is in.
   </td>
   <td>Enables the Semgrep Slack app to respond when users mention it in the chat.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/channels:read">channels:read</a></strong> 
   </td>
   <td>View basic information about public channels in a workspace.
   </td>
   <td>Basic channel information such as <code>channel_id</code> is used to ensure that Semgrep findings (results) are sent to the appropriate channel.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/chat:write">chat:write</a></strong>
   </td>
   <td>Send messages as <code>@Semgrep</code>.
   </td>
   <td>Enables the Semgrep Slack app to send findings to channels.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/chat:write.customize">chat:write.customize</a></strong>
   </td>
   <td>Send messages as <code>@Semgrep</code> with a customized username and avatar.
   </td>
   <td>Helps users identify Semgrep Slack app messages through the use of an image and username.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/chat:write.public">chat:write.public</a></strong>
   </td>
   <td>Send messages to channels <code>@Semgrep</code> isn't a member of.
   </td>
   <td>Enables users to invoke Semgrep Slack app features in any public channel using the slash command.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/commands">commands</a></strong>
   </td>
   <td>Add shortcuts or slash commands that people can use.
   </td>
   <td>Enables the Semgrep Slack app to register custom slash commands such as <code>/semgrep_subscribe</code> used for notification subscription.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/emoji:read">emoji:read</a></strong>
   </td>
   <td>View custom emoji in a workspace.
   </td>
   <td>Allows Semgrep to support a workspace's custom emojis.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/im:write">im:write</a></strong>
   </td>
   <td>Start direct messages with people.
   </td>
   <td>Allows users to interact with the Semgrep Slack app and use the slash commands in direct messages.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/links:write">links:write</a></strong>
   </td>
   <td>Show previews of URLs in messages.
   </td>
   <td>Enables Semgrep Slack app to include links in messages.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/users:read">users:read</a></strong>
   </td>
   <td>View profile details about people in a workspace.
   </td>
   <td>Enables Semgrep Slack app to correctly address users in messages.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/users:write">users:write</a></strong>
   </td>
   <td>Set presence for Semgrep.
   </td>
   <td>Used by the Semgrep Slack app to interact with the workspace and enables users to add the Semgrep Slack app to relevant channels.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/workflow.steps:execute">workflow.steps:execute</a></strong>
   </td>
   <td>Add steps that people can use in Workflow Builder.
   </td>
   <td>Enables Semgrep to make use of modals and drop-down boxes when a user creates or updates their notifications.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/groups:read">groups:read</a></strong>
   </td>
   <td>View basic information about private channels that your Slack app has been added to.
   </td>
   <td>Semgrep Slack app uses <code>channels_id_changed</code> to update its notifications config if the channel that receives findings is updated. This ensures that you are able to receive findings ever renaming a channel.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/team:read">team:read</a></strong>
   </td>
   <td>View the name, email domain, and icon for workspaces your slack app is connected to.
   </td>
   <td>Semgrep Slack app uses <code>team_name_changed</code> to update its notifications config if the team name is updated. This ensures that you are able to receive findings notifications even after renaming your team.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/channels:read">channels:read</a></strong>
   </td>
   <td>View basic information about public channels in a workspace.
   </td>
   <td>Enables Semgrep Slack app to monitor if channels that receive Semgrep findings have been deleted or archived.
   </td>
  </tr>
</table>

<!--
Unused and removed for now:
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/users.profile:read">users.profile:read</a></strong>
   </td>
   <td>View people in a workspace.
   </td>
   <td>Will be used to know the status of the users before interacting or sending out notifications.
   </td>
  </tr>
  <tr>
   <td><strong><a href="https://api.slack.com/scopes/reactions:write">reactions:write</a></strong>
   </td>
   <td>Add and edit emoji reactions.
   </td>
   <td>Will be used by Semgrep app to add a reaction to the messages that it sends.
   </td>
  </tr>

-->

#### Additional resources
* https://api.slack.com/apps
* https://api.slack.com/messaging/webhooks#enable_webhooks

### Email

Receive Semgrep findings via email.

To set up email integration:

1. In **Integrations,** click **Add Integration.**
2. Click on **Email**.
3. Enter a **Name** for the integration.
4. Enter the **Email address** that will receive Semgrep findings.
5. Click **Save.**
6. Turn notifications on by going to the **Rule board**, clicking on the <i class="fa-solid fa-gear"></i> **gear** icon, and then click the <i class="fa-solid fa-toggle-large-on"></i> **toggle** next to the name of the integration.

![Screenshot of Semgrep Cloud Platform email with findings ](/img/integrations-email-findings.png#bordered)
*Figure 2.* Sample of an email sent from Semgrep with findings.

:::note Number of emails
On each scan that has at least one finding, you will receive **one email** from Semgrep with a summary of all of the findings from that scan.
:::

### GitHub pull request comments

Pull request comments are created when:

1. Semgrep finds a result in CI.
2. The Semgrep GitHub App has permissions to post inline PR comments.

Automated comments on GitHub pull requests are displayed as follows:

![Screenshot of a GitHub PR comment](/img/semgrep-pull-request.png#bordered)
*Figure 3.* An inline GitHub pull request comment.

[Semgrep Cloud Platform](https://semgrep.dev/manage) uses the permissions requested by [the Semgrep GitHub App](https://github.com/marketplace/semgrep-dev) to leave PR comments. You can verify that you have granted these permissions by visiting either `https://github.com/organizations/<your_org_name>/settings/installations` or `https://github.com/organizations/<your_org_name>/<your_repo_name>/settings/installations`.

If you are using GitHub Actions to run Semgrep, no extra changes are needed to get PR comments. If you are using another CI provider, in addition to the environment variables you set after following [sample CI configurations](/semgrep-ci/sample-ci-configs/) you need to ensure that the following environment variables are correctly defined:

- `SEMGREP_PR_ID` is set to the PR number of the pull request on Github (for example, `2901`)
- `SEMGREP_REPO_NAME` is set to the repo name (for example, `returntocorp/semgrep`)
- `SEMGREP_REPO_URL` is set to the repository URL where your project is viewable online (for example, `https://github.com/returntocorp/semgrep`)

### GitLab merge request comments

:::info Prerequisites
- GitLab MR comments are only available to Semgrep Cloud Platform users.
- Established connection between GitLab and Semgrep Cloud Platform. The **SEMGREP_APP_TOKEN** added among your CI/CD variables in GitLab. See the [CI providers listed in Semgrep Cloud Platform](/semgrep-ci/running-semgrep-ci-with-semgrep-cloud-platform/#ci-providers-listed-in-semgrep-cloud-platform) section and [GitLab CI/CD variables](https://docs.gitlab.com/ee/ci/variables/) in GitLab documentation.
:::

This section documents how to enable Semgrep Cloud Platform to post comments on merge requests.

Automated comments on GitLab merge requests are displayed as follows:

![Semgrep GitLab MR comment](/img/gitlab-mr-comment.png)
*Figure 4.* An inline GitLab merge request comment.

To enable GitLab merge request comments, follow these steps:

1. In GitLab, go to [Profile > Access Tokens](https://gitlab.com/-/profile/personal_access_tokens), and then add a token with `api` scope.
1. Copy the token created in the previous step.
1. Navigate to **Your repository** >  **Settings** > **CI/CD**. The URL of the page where you are ends with: `/username/project/-/settings/ci_cd`.
1. Under **Variables** click **Expand**, and then click **Add variable**.
1. Enter **PAT** (change this placeholder name as necessary) in the **Key** field and paste the token value copied in step two to the **Value** field.
1. Select the **Mask variable** checkbox option, and then clear the **Protect variable** checkbox option.
1. Update your `.gitlab-ci.yml` file with variable `GITLAB_TOKEN` and value `$PAT`. Refer to the following example:
```yaml
semgrep:
  # A Docker image with Semgrep installed.
  image: returntocorp/semgrep
  # Run the "semgrep ci" command on the command line of the docker image.
  script: semgrep ci

  rules:
  # Scan changed files in MRs, (diff-aware scanning):
  - if: $CI_MERGE_REQUEST_IID

  # Scan mainline (default) branches and report all findings.
  - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

  variables:
    # Connect to Semgrep Cloud Platform through your SEMGREP_APP_TOKEN.
    # Generate a token from Semgrep Cloud Platform > Settings
    # and add it as a variable in your GitLab CI/CD project settings.
    SEMGREP_APP_TOKEN: $SEMGREP_APP_TOKEN
    # Receive inline MR comments (requires Semgrep Cloud Platform account)
    GITLAB_TOKEN: $PAT
```
Substitute the placeholder <code><span className="placeholder">PAT</span></code> with the name you created for this variable.

For more configuration options, see [GitLab CI Sample](/semgrep-ci/sample-ci-configs/#gitlab-ci).

:::info
Only rules in the **Comment** and **Block** columns of your [Rule board](https://semgrep.dev/orgs/-/board) create the MR comments. Rules from the **Block** will also block the MR pipeline. To unblock the pipeline, the detected code needs to be fixed.
:::

### Bitbucket pull request comments

:::info Prerequisite
Bitbucket PR comments are only available to Semgrep Cloud Platform users.
:::

There are two ways in which you can integrate Semgrep comments into your Bitbucket CI depending on the Bitbucket plan you use:

- **Workspace access token**: If you use the Bitbucket Cloud Premium plan, you can create a workspace access token. This option saves time because you can create one access token for all repositories in the workspace. With one workspace access token, you can bulk-onboard more repositories at once from a whole workspace. See [Creating a workspace access token](/semgrep-code/notifications/#creating-and-adding-a-workspace-access-token). However, you can also use the option of a repository access token to onboard repositories one by one.
- **Repository access token**: If you do **not** have the Bitbucket Cloud Premium plan, create a separate repository access token for each repository where you want to use Semgrep. This configuration option is also useful if you have the Bitbucket Cloud Premium plan, but prefer to onboard repositories one by one instead of bulk onboarding. See [Creating a repository access token](/semgrep-code/notifications/#creating-and-adding-a-repository-access-token).

#### Creating and adding a workspace access token

:::info Prerequisites
- Configured pipeline in Bitbucket Cloud.
- **Bitbucket Cloud Premium** plan. If you are **not** using the Bitbucket Cloud Premium plan, create a separate repository access token for each repository where you want to use Semgrep, for more information, see [Creating a repository access token](/semgrep-code/notifications/#creating-and-adding-a-repository-access-token).
- Established connection between Bitbucket and Semgrep Cloud Platform. The **SEMGREP_APP_TOKEN** added as a **workspace** variable in Bitbucket. See the [CI providers listed in Semgrep Cloud Platform](/semgrep-ci/running-semgrep-ci-with-semgrep-cloud-platform/#ci-providers-listed-in-semgrep-cloud-platform) section and [Workspace variables](https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/#Workspace-variables) in Bitbucket documentation.
:::

Create a workspace access token in Bitbucket (only available if you have a Bitbucket Cloud Premium plan). Fulfill these general steps to create a workspace access token:

1. Create a workspace access token in Bitbucket with **Read** and **Write** permissions for pull requests. Follow the instructions in [Create a workspace Access Token](https://support.atlassian.com/bitbucket-cloud/docs/create-a-workspace-access-token/) in Bitbucket documentation.
1. Add the workspace access token as a workspace variable with the **Secured** option.

To complete the configuration, follow the [Adding Semgrep to your Bitbucket CI pipeline for PR comments](#bitbucket-ci-pipelines-yaml-file-for-pr-comments) section.

#### Creating and adding a repository access token

:::info Prerequisites
- Configured pipeline in Bitbucket Cloud.
- Established connection between Bitbucket and Semgrep Cloud Platform. The **SEMGREP_APP_TOKEN** added as a **repository** variable in Bitbucket. See the [Creating a SEMGREP_APP_TOKEN](/semgrep-ci/running-semgrep-ci-with-semgrep-cloud-platform/#creating-a-semgrep_app_token) section and [Repository variables](https://support.atlassian.com/bitbucket-cloud/docs/variables-and-secrets/#Repository-variables) in Bitbucket documentation.
:::

:::note
This section helps you to configure PR comments if you do **not** have a Bitbucket Cloud Premium plan. You can create a separate repository access token for each repository where you want to use Semgrep. This configuration option is also useful if you have the Bitbucket Cloud Premium plan, but prefer to onboard repositories one by one instead of bulk onboarding.
:::

Fulfill these general steps to create a repository access token:

1. Create a repository access token in Bitbucket with **Read**, and **Write** permissions for pull requests. Follow the instructions in [Create a repository Access Token](https://support.atlassian.com/bitbucket-cloud/docs/create-a-repository-access-token/) in Bitbucket documentation.
1. Add the repository access token as a repository variable with the **Secured** option.

To complete the configuration, follow the [Adding Semgrep to your Bitbucket CI pipeline for PR comments](/semgrep-code/notifications/#bitbucket-ci-pipelines-yaml-file-for-pr-comments) section.

#### Bitbucket CI pipelines YAML file for PR comments

:::info Prerequisite
Finish the steps in either [Creating a workspace access token](/semgrep-code/notifications/#creating-and-adding-a-workspace-access-token) (if you have **Bitbucket Cloud Premium** plan), or [Creating a repository access token](/semgrep-code/notifications/#creating-and-adding-a-repository-access-token) before committing the file below.
:::

Commit the following code to your `bitbucket-pipelines.yml` file:

```yaml
image: atlassian/default-image:latest

pipelines:
  branches:
    main:
        - step:
            name: 'Run Semgrep full scan with main branch'
            image: returntocorp/semgrep
            script:
              - export SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN
              - semgrep ci
  pull-requests:
    '**':
      - step:
          name: 'Run Semgrep diff scan with PR branch'
          image: returntocorp/semgrep
          script:
            # Set SEMGREP Variables
            - export SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN
            - export SEMGREP_BASELINE_REF="origin/main"
            - git fetch origin "+refs/heads/*:refs/remotes/origin/*"
            - export BITBUCKET_TOKEN=$PAT
            - semgrep ci
```
Substitute the placeholder <code><span className="placeholder">PAT</span></code> and <code><span className="placeholder">main</span></code> according to your workspace or repository settings.

:::info
The updated `bitbucket-pipelines.yml` YAML file must be also included in the branches where you want Semgrep to run.
:::

As a result, your Bitbucket repositories are now part of the [Projects](https://semgrep.dev/orgs/-/projects) page. You may now receive comments on PRs from Semgrep Cloud Platform. For more configuration options, see [Bitbucket Pipelines CI Sample](/semgrep-ci/sample-ci-configs/#bitbucket-pipelines). Examples of more CI pipelines that you can use in Bitbucket CMS can be found in [Sample continuous integration (CI) configurations](https://semgrep.dev/docs/semgrep-ci/sample-ci-configs/).

:::info
Only rules in the **Comment** and **Block** columns of your [Rule board](https://semgrep.dev/orgs/-/board) create the PR comments. Rules from the **Block** will also block the PR pipeline. To unblock the pipeline, the detected code needs to be fixed.
:::

### Semgrep Autofix

[Autofix](/writing-rules/autofix) is a Semgrep feature in which rules contain suggested fixes to resolve findings. Either metavariables or regex matches are replaced with a potential fix. Due to their complexity, not all rules make use of autofix, but for rules that use this feature, autofix allows you to quickly resolve findings as part of your code review workflow. Semgrep Code can suggest these fixes through PR or MR comments within GitHub or GitLab, thus integrating seamlessly with your review environment.

Autofix is free to use for all tiers.

In the following screenshot, Semgrep detects the use of a native Python XML library, which is vulnerable to XML external entity (XXE) attacks. The PR comment automatically suggests a fix by replacing `import xml` to `import defusedxml`.

![Screenshot of a sample autofix PR suggestion](/img/notifications-github-suggestions.png)

#### Enabling autofix for GitHub or GitLab 

Autofix requires PR or MR comments to be enabled for your repository or organization. Follow the steps in [GitHub pull request comments](#github-pull-request-comments) or [GitLab merge request comments](#gitlab-merge-request-comments) to enable this feature.

<EnableAutofix />

All scans performed after enabling autofix generate inline PR or MR comments with code suggestions for applicable rules.

### Webhooks

Webhooks are a feature available in Semgrep's Team tier and above.

Webhooks are a generic method for Semgrep to post JSON-formatted findings after each scan to your URL endpoint. To set up a webhook:

1. Go to **Settings** > **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)**, and then click **Add Integration**.
2. Click **Webhook**.
3. Enter a **Name** for the integration.
4. Enter the **Webhook URL**.
5. To ensure that Semgrep can post to your URL, click **Test**. 
![Successful webhook integration test](/img/webhook-successful-test.png)<br />
6. Click **Save.**
7. Turn notifications on by going to the **Rule board**, clicking on the <i class="fa-solid fa-gear"></i> **gear** icon, then click the <i class="fa-solid fa-toggle-large-on"></i> **toggle** next to the name of the integration.
To receive webhook notifications on pull requests and code pushes, visit [Dashboard > Integrations](https://semgrep.dev/manage/integrations) and select 'Add integration' or 'Setup First Integration,' and then choose 'Webhook'. Enter a target URL, give the notification channel a name of your choosing, and then click 'Save'.

#### Findings

```json
[
  {
    "semgrep_finding": {
      "id": "241dbe518caf15f800131d2d0c70bf08",
      "ref": "refs/pull/2658/merge",
      "start_date": "None",
      "check_id": "log-exc-info",
      "path": "server/semgrep_app/handlers/registry.py",
      "line": 185,
      "column": 9,
      "message": "Error messages should be logged with `exc_info=True` in order to propagate\nstack information to Sentry. Either change the logging level or raise an Exception.\n",
      "severity": 1,
      "index": 0,
      "end_line": 187,
      "end_column": 10,
      "commit_date": "2021-06-07T15:26:35+03:00",
      "first_seen_scan_id": "xnkPGY8VL20o",
      "category": "security",
      "cwe": "CWE-319: Cleartext Transmission of Sensitive Information",
      "license": "Commons Clause License Condition v1.0[LGPL-2.1-only]",
      "owasp": "A3: Sensitive Data Exposure",
      "references": ["https://tomcat.apache.org/tomcat-5.5-doc/servletapi/"],
      "source": "https://semgrep.dev/r/java.servlets.security.cookie-issecure-false.cookie-issecure-false",
      "technology": ["servlet",  "tomcat"],
      "vulnerability": "Insecure Transport",
      "metadata": {
        "dev.semgrep.actions": [],
        "semgrep.policy": {
          "id": 8168,
          "name": "Web Apps Notify Only",
          "slug": "web-apps-notify-only"
        },
        "semgrep.url": "https://semgrep.dev/s/johndoe:log-exc-info"
      }
    }
  }
]
```

#### Scans

Semgrep Cloud Platform can send a POST request containing information about the scan.

```json
{
  "semgrep_scan": {
    "deployment_id": 1,
    "started_at": "2021-09-21T23:49:17.480929+00:00",
    "completed_at": null,
    "exit_code": null,
    "repository": "returntocorp/semgrep-app",
    "ci_job_url": "https://github.com/returntocorp/semgrep-app/actions/runs/1236121005",
    "environment": "",
    "commit": "e22f08e8e871bde8c100b3a4a6f8e9387d651223",
    "commit_committer_email": "",
    "commit_timestamp": "",
    "commit_author_email": "support@semgrep.com",
    "commit_author_name": "Semgrep User",
    "commit_author_username": "semgrepuser",
    "commit_author_image_url": "https://avatars.githubusercontent.com/u/29760937?s=200&v=4",
    "commit_authored_timestamp": "",
    "commit_title": "fixup",
    "config": "",
    "on": "pull_request",
    "branch": "refs/pull/3483/merge",
    "pull_request_timestamp": "",
    "pull_request_author_username": "semgrepuser",
    "pull_request_author_image_url": "https://avatars.githubusercontent.com/u/29760937?s=200&v=4",
    "pull_request_id": "3483",
    "pull_request_title": "test bad commit",
    "ignored_files": ["/server/semgrep_app/templates/"],
    "id": "xnkPGY8VL20o"
  }
}
```

### Jira

:::warning Deprecation notice
Creating Jira tickets from Findings page has been deprecated. This feature may be reenabled in the future.
:::

Jira integration is a feature available in Semgrep's Team tier and above.

This integration allows you to create Jira tickets directly from the **Findings** page with relevant information about a particular finding.

To set up Jira integration:

1. Sign in to your Semgrep Cloud Platform account, and then go to **Settings** > **[Integrations](https://semgrep.dev/orgs/-/settings/integrations)**..
2. 1. On the [Integrations](https://semgrep.dev/orgs/-/settings/integrations) page, click **Add Integration** (or **Setup First Integration** if this is your first integration), and then select **Jira.**
3. Enter a **Name** of the integration.
4. Enter the **email address** used for the Atlassian account.
5. Enter your Atlassian **domain URL**.
6. Enter your **Project key**. This is the prefix for tasks created within a project. Semgrep creates issues to the project identified here.
7. Enter the **Issue type.** This is the type of issue for Semgrep findings, for example, *Bug.*
8. Enter the **API Token**.
    - Generate the API token by following instructions in the **Create an API token** section in the following documentation: [Manage API Tokens](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account).
    - Find existing API tokens in the [API Tokens](https://id.atlassian.com/manage-profile/security/api-tokens) page.
9. Click **Save.**

<!--- Commented out as this feature is no longer available TODO add and edit this section when Jira integration is back.

To create a Jira ticket in Semgrep Cloud Platform:

1. In **Findings**, click on the **three-dot icon** of the entry to create a Jira ticket for the finding.
![Creating a Jira ticket from the Findings page](/img/jira-findings-page.png)<br />
2. Select **Create issue with `[YOUR_INTEGRATION_NAME]`**.
![Output of Jira integration](/img/jira-template.png)
--->

## Notification and alert de-duplication

Notifications are sent only the first time a given finding is detected.

Because of Semgrep CI's diff-awareness, you will not be notified
when a pull request has a finding that existed on the base branch already,
even if that line is moved or re-indented.

Semgrep Cloud Platform also keeps track of notifications that have already been sent,
so consecutive scans of the same changes in the same pull request
won't send duplicate notifications.

<!--- Deprecated
### Amazon S3

1. In **Integrations,** click **Add Integration**.
2. Click **AWS S3**.
3. Enter the AWS 3 **Channel name**. This is where Semgrep will post findings.
4. Optional: Select the **Inventory** check box to receive notifications about Code Asset Inventory findings.
5. To ensure that Semgrep can post to your channel, click **Test**.
6. Click **Save.**
7. Turn notifications on by going to the **Rule board**, clicking on the <i class="fa-solid fa-gear"></i> **gear** icon, then click the <i class="fa-solid fa-toggle-large-on"></i> **toggle** next to the name of the integration.
--->

<MoreHelp />
